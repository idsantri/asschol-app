import{b9 as E,ba as w,z as S}from"./index-Dg2giWPB.js";function y(r,e){const o=e.method||"GET";console.group("-+-~-+-~-+-~-+-~-+- API Request: "+new Date().toISOString()+" -+-~-+-~-+-~-+-~-+-"),console.log(`ðŸš€ ${o}: ${r}`),console.log("ðŸ“‹ Headers:",e?.headers||"-"),console.log("ðŸ“¦ Body:",e?.body||"-"),console.log("ðŸ” Params:",e?.params||"-"),console.groupEnd()}function u(r,e){const o=r.requestStart||Date.now(),t=Date.now()-o,s=r.ok?"âœ…":"âŒ";if(console.group(`${s} API Response: ${r.status} ${r.statusText}`),console.log("ðŸŒ URL:",r.url),console.log("â±ï¸ Duration:",`${t}ms`),console.log("ðŸ“… Response Time:",new Date().toISOString()),e&&(console.group("ðŸ“„ Response Data:"),console.log("error: ",e.error),console.log("message: ",e.message),console.log("data: ",e.data),console.groupEnd()),r.headers){const a={};r.headers.forEach((n,c)=>{a[c]=n}),console.log("ðŸ“‹ Response Headers:",a)}console.groupEnd()}function f({error:r,fullUrl:e,options:o}){const t=Date.now(),s=Date.now()-t,a=o.method||"GET";console.group(`ðŸ’¥ API Error: ${a} ${e}`),console.error("âŒ Error:",r),console.error("ðŸŒ URL:",e),console.error("ðŸ”§ Method:",a),console.error("â±ï¸ Duration:",`${s}ms`),console.error("ðŸ“… Error Time:",new Date().toISOString()),console.groupEnd()}function p(r,e){const o=e.method||"GET";console.group(`ðŸ” Auth Error: ${o} ${r}`),console.error("âŒ No access token found"),console.error("ðŸŒ URL:",r),console.error("ðŸ”§ Method:",o),console.error("ðŸ“… Error Time:",new Date().toISOString()),console.groupEnd(),console.error("No access token found")}const m=r=>{w.create({type:"positive",message:r,color:"green-5",textColor:"green-11",html:!0})},i=r=>{w.create({type:"negative",message:r,html:!0})};async function L(r,e=!1,o="Konfirmasi"){return new Promise(t=>{E.create({title:o,message:r,cancel:!0,persistent:e,html:!0}).onOk(async()=>{t(!0)}).onCancel(()=>{t(!1)}).onDismiss(()=>{t(!1)})})}async function k(r,e,o){try{const t=await r.json().catch(()=>null),s={status:r.status,statusText:r.statusText,message:t?.message||"Server error occurred",timestamp:new Date().toISOString(),url:r.url};switch(r.status){case 500:console.error("Internal Server Error - The server encountered an unexpected condition"),e.showError&&i("Terjadi kesalahan pada server. Hubungi developer.");break;case 501:console.error("Not Implemented - The server does not support this functionality"),e.showError&&i("Fitur ini belum tersedia. Hubungi developer.");break;case 502:console.error("Bad Gateway - Invalid response from upstream server"),e.showError&&i("Server tidak merespons dengan benar. Silakan coba lagi.");break;case 503:console.error("Service Unavailable - Server temporarily overloaded or under maintenance"),e.showError&&i("Server sedang dalam perawatan. Silakan coba lagi nanti.");break;case 504:console.error("Gateway Timeout - Upstream server timeout"),e.showError&&i("Koneksi ke server terputus. Silakan coba lagi nanti.");break;default:console.error(`Server Error ${r.status}: ${r.statusText}`),e.showError&&i(`Terjadi kesalahan pada server: ${s.message}`);break}throw o&&u(r,t),new Error(`Server Error ${r.status}: ${s.message}`)}catch(t){throw console.error("Failed to parse server error response:",t),new Error(`Server Error ${r.status}: ${r.statusText}`)}}async function b(r,e,o){let t="Terjadi kesalahan pada server",s=null;try{s=await r.json(),t=s.message||t}catch(a){throw console.error("Failed to parse error response:",a),i("Not valid JSON response!"),a}throw e.showError&&i(t),o&&u(r,s),s||new Error(t)}async function d(r,e,o){r.status>=500?await k(r,e,o):await b(r,e,o)}async function v(r,e,o,t){const s=r.url||"unknown";let a;try{a=await r.json()}catch(c){throw t&&f({error:c,fullUrl:s,options:e}),o.showError&&i("Gagal memproses respons server"),c}const{message:n}=a;return o.showSuccess&&m(n||"Success"),a}class ${constructor(){this.BASE_URL="https://asschol.idsantri.my.id/",this.notifyConfig={showSuccess:!0,showError:!0},this.withLog=!1,this.isTest=!1}getAccessToken(){return S().token||null}setNotify(e){typeof e=="boolean"?this.notifyConfig={showSuccess:e,showError:e}:typeof e=="object"&&e!==null?this.notifyConfig={showSuccess:!!e.showSuccess,showError:!!e.showError}:this.notifyConfig={showSuccess:!0,showError:!0}}setNotifyGet(){this.setNotify({showSuccess:!1,showError:!0})}defaultConfig(){this.isTest?(this.setNotify(!1),this.setLog(!0)):(this.setNotify(!0),this.setLog(!1))}getNotify(){return{...this.notifyConfig}}setLog(e){this.withLog=!!e}getLog(){return this.withLog}buildQueryString(e){if(!e||typeof e!="object")return"";const t=new URLSearchParams(Object.entries(e).filter(([,s])=>s!=null)).toString();return t?`?${t}`:""}async performFetch(e,o){const t=Date.now(),s=Intl.DateTimeFormat().resolvedOptions().timeZone,a={...o,headers:{...o.headers,"X-Timezone":s}};this.withLog&&y(e,a);try{const n=await fetch(e,a);return n.requestStart=t,n}catch(n){throw this.withLog&&f({error:n,fullUrl:e,options:a}),this.notifyConfig.showError&&i("Gagal terhubung ke server"),n}}async handleApi(e,o){if(!e.ok){await d(e,this.notifyConfig,this.withLog);return}const t=await v(e,o,this.notifyConfig,this.withLog);return this.withLog&&u(e,t),t}async fetchGuest(e,o={}){const{params:t,...s}=o;s.headers={...o.headers,"Content-Type":"application/json"};const a=this.buildQueryString(t),n=this.BASE_URL+e+a,c=await this.performFetch(n,s);return this.handleApi(c,s)}async fetchAuth(e,o={}){const t=this.getAccessToken();if(!t)throw this.withLog&&p(this.BASE_URL+e,o),this.notifyConfig.showError&&i({message:"Tidak ada token akses yang ditemukan"}),new Error("No access token found");return this.fetchGuest(e,{...o,headers:{...o.headers,Authorization:`Bearer ${t}`}})}async fetchFile(e,o,t={}){const{params:s,...a}=t,n=this.buildQueryString(s),c=this.BASE_URL+e+n,g=this.getAccessToken();g&&(a.headers={...a.headers,Authorization:`Bearer ${g}`});const h=await this.performFetch(c,a);if(!h.ok)throw await d(h,this.notifyConfig,this.withLog),new Error("Failed to fetch file");try{const l=await h.blob();return this.withLog&&u(h,{message:"File fetched successfully"}),this.notifyConfig.showSuccess&&m(`File ${o} berhasil diunduh`),l}catch(l){throw this.withLog&&f({error:l,fullUrl:c,options:a}),this.notifyConfig.showError&&i("Gagal memproses file dari server"),l}}}export{$ as A,m as a,L as n};
